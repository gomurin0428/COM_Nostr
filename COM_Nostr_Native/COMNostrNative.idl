// COM_Nostr_Native.idl : IDL definitions for ATL-based COM_Nostr_Native.
// Mirrors the COM interfaces that COM_Nostr exposes.

import "oaidl.idl";
import "ocidl.idl";

[
    uuid(73a9e0cc-1c6c-4e6f-bbec-ce22a88b4087),
    version(1.0),
    helpstring("COM_Nostr_Native Type Library")
]
library COMNostrNativeLib
{
    importlib("stdole2.tlb");

    typedef [v1_enum] enum RelaySessionState
    {
        RelaySessionState_Disconnected = 0,
        RelaySessionState_Connecting = 1,
        RelaySessionState_Connected = 2,
        RelaySessionState_Faulted = 3
    } RelaySessionState;

    typedef [v1_enum] enum SubscriptionStatus
    {
        SubscriptionStatus_Pending = 0,
        SubscriptionStatus_Active = 1,
        SubscriptionStatus_Draining = 2,
        SubscriptionStatus_Closed = 3
    } SubscriptionStatus;

    typedef [v1_enum] enum QueueOverflowStrategy
    {
        QueueOverflowStrategy_DropOldest = 0,
        QueueOverflowStrategy_Throw = 1
    } QueueOverflowStrategy;

    dispinterface INostrEventCallback;
    dispinterface INostrAuthCallback;
    dispinterface INostrSigner;
    interface INostrRelaySession;
    interface INostrSubscription;
    interface INostrClient;

    [
        uuid(fa6b2b97-da84-47d7-9395-3be07d18bb8a)
    ]
    dispinterface INostrEventCallback
    {
        properties:
        methods:
            [id(1)] void OnEvent(BSTR relayUrl, IDispatch* eventPayload);
            [id(2)] void OnEndOfStoredEvents(BSTR relayUrl, BSTR subscriptionId);
            [id(3)] void OnNotice(BSTR relayUrl, BSTR message);
            [id(4)] void OnClosed(BSTR relayUrl, BSTR subscriptionId, BSTR reason);
    };

    [
        uuid(0168a3e9-0da9-4fbe-92c7-6fb10c12c536)
    ]
    dispinterface INostrAuthCallback
    {
        properties:
        methods:
            [id(1)] void OnAuthRequired(IDispatch* challenge);
            [id(2)] void OnAuthSucceeded(BSTR relayUrl);
            [id(3)] void OnAuthFailed(BSTR relayUrl, BSTR reason);
    };

    [
        uuid(0c458d3c-2e65-4a90-9f64-7809e944adbc)
    ]
    dispinterface INostrSigner
    {
        properties:
        methods:
            [id(1)] BSTR Sign(IDispatch* draft);
            [id(2)] BSTR GetPublicKey();
    };

    [
        object,
        uuid(b67fcdef-060a-48e2-aa7a-e005be256b4d),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrEvent : IDispatch
    {
        [id(1), propget] HRESULT Id([out, retval] BSTR* value);
        [id(1), propput] HRESULT Id([in] BSTR value);
        [id(2), propget] HRESULT PublicKey([out, retval] BSTR* value);
        [id(2), propput] HRESULT PublicKey([in] BSTR value);
        [id(3), propget] HRESULT CreatedAt([out, retval] DOUBLE* value);
        [id(3), propput] HRESULT CreatedAt([in] DOUBLE value);
        [id(4), propget] HRESULT Kind([out, retval] LONG* value);
        [id(4), propput] HRESULT Kind([in] LONG value);
        [id(5), propget] HRESULT Tags([out, retval] SAFEARRAY(VARIANT)* value);
        [id(5), propput] HRESULT Tags([in] SAFEARRAY(VARIANT) value);
        [id(6), propget] HRESULT Content([out, retval] BSTR* value);
        [id(6), propput] HRESULT Content([in] BSTR value);
        [id(7), propget] HRESULT Signature([out, retval] BSTR* value);
        [id(7), propput] HRESULT Signature([in] BSTR value);
    };

    [
        object,
        uuid(735c552b-ea89-4811-adbe-ac5bfdcb30a2),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrFilter : IDispatch
    {
        [id(1), propget] HRESULT Ids([out, retval] SAFEARRAY(BSTR)* value);
        [id(1), propput] HRESULT Ids([in] SAFEARRAY(BSTR) value);
        [id(2), propget] HRESULT Authors([out, retval] SAFEARRAY(BSTR)* value);
        [id(2), propput] HRESULT Authors([in] SAFEARRAY(BSTR) value);
        [id(3), propget] HRESULT Kinds([out, retval] SAFEARRAY(LONG)* value);
        [id(3), propput] HRESULT Kinds([in] SAFEARRAY(LONG) value);
        [id(4), propget] HRESULT Tags([out, retval] SAFEARRAY(IDispatch*)* value);
        [id(4), propput] HRESULT Tags([in] SAFEARRAY(IDispatch*) value);
        [id(5), propget] HRESULT Since([out, retval] VARIANT* value);
        [id(5), propput] HRESULT Since([in] VARIANT value);
        [id(6), propget] HRESULT Until([out, retval] VARIANT* value);
        [id(6), propput] HRESULT Until([in] VARIANT value);
        [id(7), propget] HRESULT Limit([out, retval] VARIANT* value);
        [id(7), propput] HRESULT Limit([in] VARIANT value);
    };

    [
        object,
        uuid(70aa92a3-62ea-4622-950c-1f20b187fead),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrTagQuery : IDispatch
    {
        [id(1), propget] HRESULT Label([out, retval] BSTR* value);
        [id(1), propput] HRESULT Label([in] BSTR value);
        [id(2), propget] HRESULT Values([out, retval] SAFEARRAY(BSTR)* value);
        [id(2), propput] HRESULT Values([in] SAFEARRAY(BSTR) value);
    };

    [
        object,
        uuid(84d3b9ea-fc37-44bf-9dec-e5b223e897c1),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface IRelayDescriptor : IDispatch
    {
        [id(1), propget] HRESULT Url([out, retval] BSTR* value);
        [id(1), propput] HRESULT Url([in] BSTR value);
        [id(2), propget] HRESULT ReadEnabled([out, retval] VARIANT_BOOL* value);
        [id(2), propput] HRESULT ReadEnabled([in] VARIANT_BOOL value);
        [id(3), propget] HRESULT WriteEnabled([out, retval] VARIANT_BOOL* value);
        [id(3), propput] HRESULT WriteEnabled([in] VARIANT_BOOL value);
        [id(4), propget] HRESULT Preferred([out, retval] VARIANT_BOOL* value);
        [id(4), propput] HRESULT Preferred([in] VARIANT_BOOL value);
        [id(5), propget] HRESULT Metadata([out, retval] VARIANT* value);
        [id(5), propput] HRESULT Metadata([in] VARIANT value);
    };

    [
        object,
        uuid(e00bff8d-81b7-4f09-8e43-5d4028aff887),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface ISubscriptionOptions : IDispatch
    {
        [id(1), propget] HRESULT KeepAlive([out, retval] VARIANT_BOOL* value);
        [id(1), propput] HRESULT KeepAlive([in] VARIANT_BOOL value);
        [id(2), propget] HRESULT AutoRequeryWindowSeconds([out, retval] VARIANT* value);
        [id(2), propput] HRESULT AutoRequeryWindowSeconds([in] VARIANT value);
        [id(3), propget] HRESULT MaxQueueLength([out, retval] VARIANT* value);
        [id(3), propput] HRESULT MaxQueueLength([in] VARIANT value);
        [id(4), propget] HRESULT QueueOverflowStrategy([out, retval] VARIANT* value);
        [id(4), propput] HRESULT QueueOverflowStrategy([in] VARIANT value);
    };

    [
        object,
        uuid(6c67eb82-6b08-4581-9b8e-d64e0055fdad),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface IAuthChallenge : IDispatch
    {
        [id(1), propget] HRESULT RelayUrl([out, retval] BSTR* value);
        [id(1), propput] HRESULT RelayUrl([in] BSTR value);
        [id(2), propget] HRESULT Challenge([out, retval] BSTR* value);
        [id(2), propput] HRESULT Challenge([in] BSTR value);
        [id(3), propget] HRESULT ExpiresAt([out, retval] VARIANT* value);
        [id(3), propput] HRESULT ExpiresAt([in] VARIANT value);
    };

    [
        object,
        uuid(e84bda88-f83e-4780-9e9e-ba9bd0f4e342),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrEventDraft : IDispatch
    {
        [id(1), propget] HRESULT PublicKey([out, retval] BSTR* value);
        [id(1), propput] HRESULT PublicKey([in] BSTR value);
        [id(2), propget] HRESULT CreatedAt([out, retval] DOUBLE* value);
        [id(2), propput] HRESULT CreatedAt([in] DOUBLE value);
        [id(3), propget] HRESULT Kind([out, retval] LONG* value);
        [id(3), propput] HRESULT Kind([in] LONG value);
        [id(4), propget] HRESULT Tags([out, retval] SAFEARRAY(VARIANT)* value);
        [id(4), propput] HRESULT Tags([in] SAFEARRAY(VARIANT) value);
        [id(5), propget] HRESULT Content([out, retval] BSTR* value);
        [id(5), propput] HRESULT Content([in] BSTR value);
    };

    [
        object,
        uuid(4406ad1a-6e11-4126-8500-651f2377cc0c),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface IClientOptions : IDispatch
    {
        [id(1), propget] HRESULT WebSocketFactoryProgId([out, retval] BSTR* value);
        [id(1), propput] HRESULT WebSocketFactoryProgId([in] BSTR value);
        [id(2), propget] HRESULT UserAgent([out, retval] BSTR* value);
        [id(2), propput] HRESULT UserAgent([in] BSTR value);
        [id(3), propget] HRESULT ConnectTimeoutSeconds([out, retval] VARIANT* value);
        [id(3), propput] HRESULT ConnectTimeoutSeconds([in] VARIANT value);
        [id(4), propget] HRESULT SendTimeoutSeconds([out, retval] VARIANT* value);
        [id(4), propput] HRESULT SendTimeoutSeconds([in] VARIANT value);
        [id(5), propget] HRESULT ReceiveTimeoutSeconds([out, retval] VARIANT* value);
        [id(5), propput] HRESULT ReceiveTimeoutSeconds([in] VARIANT value);
    };

    [
        object,
        uuid(f86b5e8f-9767-4df0-b750-cb51506b1922),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrOkResult : IDispatch
    {
        [id(1), propget] HRESULT Success([out, retval] VARIANT_BOOL* value);
        [id(1), propput] HRESULT Success([in] VARIANT_BOOL value);
        [id(2), propget] HRESULT EventId([out, retval] BSTR* value);
        [id(2), propput] HRESULT EventId([in] BSTR value);
        [id(3), propget] HRESULT Message([out, retval] BSTR* value);
        [id(3), propput] HRESULT Message([in] BSTR value);
    };

    [
        object,
        uuid(2d375c22-fda2-4286-bcbe-81fdf2f245b5),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrRelaySession : IDispatch
    {
        [id(1), propget] HRESULT Url([out, retval] BSTR* value);
        [id(2), propget] HRESULT State([out, retval] RelaySessionState* value);
        [id(3), propget] HRESULT LastOkResult([out, retval] IDispatch** value);
        [id(4), propget] HRESULT SupportedNips([out, retval] SAFEARRAY(LONG)* value);
        [id(5), propget] HRESULT WriteEnabled([out, retval] VARIANT_BOOL* value);
        [id(6), propget] HRESULT ReadEnabled([out, retval] VARIANT_BOOL* value);
        [id(7)] HRESULT Reconnect();
        [id(8)] HRESULT Close();
        [id(9)] HRESULT GetDescriptor([out, retval] IDispatch** value);
        [id(10)] HRESULT UpdatePolicy([in] IDispatch* descriptor);
    };

    [
        object,
        uuid(143205c5-f229-4e2e-a47c-25c34a7f040d),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrSubscription : IDispatch
    {
        [id(1), propget] HRESULT Id([out, retval] BSTR* value);
        [id(2), propget] HRESULT Status([out, retval] SubscriptionStatus* value);
        [id(3), propget] HRESULT Filters([out, retval] SAFEARRAY(IDispatch*)* value);
        [id(4)] HRESULT UpdateFilters([in] SAFEARRAY(IDispatch*) filters);
        [id(5)] HRESULT Close();
    };

    [
        object,
        uuid(75f24149-8cbf-4f9c-9482-ec8374fdc7b5),
        dual,
        nonextensible,
        oleautomation,
        pointer_default(unique)
    ]
    interface INostrClient : IDispatch
    {
        [id(1)] HRESULT Initialize([in] IDispatch* options);
        [id(2)] HRESULT SetSigner([in] INostrSigner* signer);
        [id(3)] HRESULT ConnectRelay([in] IDispatch* descriptor, [in] INostrAuthCallback* authCallback, [out, retval] INostrRelaySession** session);
        [id(4)] HRESULT DisconnectRelay([in] BSTR relayUrl);
        [id(5)] HRESULT HasRelay([in] BSTR relayUrl, [out, retval] VARIANT_BOOL* hasRelay);
        [id(6)] HRESULT OpenSubscription([in] BSTR relayUrl, [in] SAFEARRAY(IDispatch*) filters, [in] INostrEventCallback* callback, [in] IDispatch* options, [out, retval] INostrSubscription** subscription);
        [id(7)] HRESULT PublishEvent([in] BSTR relayUrl, [in] IDispatch* eventPayload);
        [id(8)] HRESULT RespondAuth([in] BSTR relayUrl, [in] IDispatch* authEvent);
        [id(9)] HRESULT RefreshRelayInfo([in] BSTR relayUrl);
        [id(10)] HRESULT ListRelays([out, retval] SAFEARRAY(BSTR)* relayUrls);
    };

    [
        uuid(7d3091fe-ca18-49ba-835c-012991076660)
    ]
    coclass NostrClient
    {
        [default] interface INostrClient;
    };

    [
        uuid(e53e9b56-da8d-4064-8df6-5563708f65a5)
    ]
    coclass NostrRelaySession
    {
        [default] interface INostrRelaySession;
    };

    [
        uuid(175bd625-18d9-42bd-b75a-0642abf029b4)
    ]
    coclass NostrSubscription
    {
        [default] interface INostrSubscription;
    };

    [
        uuid(ae9df2b5-8650-4a51-8bb2-1df35a48a6ec)
    ]
    coclass NostrSigner
    {
        [default] dispinterface INostrSigner;
    };

    [
        uuid(56e23422-5e99-4be6-a29d-fb60eccb6559)
    ]
    coclass NostrEvent
    {
        [default] interface INostrEvent;
    };

    [
        uuid(ed57aa18-b9fe-4861-a6e9-66d68b9a0c49)
    ]
    coclass NostrFilter
    {
        [default] interface INostrFilter;
    };

    [
        uuid(4ed88857-740f-451e-8d1f-5959c89f31a2)
    ]
    coclass NostrTagQuery
    {
        [default] interface INostrTagQuery;
    };

    [
        uuid(43910586-5980-4cbc-8936-ea8d1d2cb584)
    ]
    coclass RelayDescriptor
    {
        [default] interface IRelayDescriptor;
    };

    [
        uuid(b8522064-312e-4ce0-b4c5-e7d59a76d073)
    ]
    coclass SubscriptionOptions
    {
        [default] interface ISubscriptionOptions;
    };

    [
        uuid(83822390-3a93-4edb-ba46-2f2dc960d08d)
    ]
    coclass AuthChallenge
    {
        [default] interface IAuthChallenge;
    };

    [
        uuid(38c8b451-af80-41d6-ae98-36ab672412e7)
    ]
    coclass NostrEventDraft
    {
        [default] interface INostrEventDraft;
    };

    [
        uuid(21831b74-c106-4809-b47d-1bec57addc7c)
    ]
    coclass ClientOptions
    {
        [default] interface IClientOptions;
    };

    [
        uuid(9b7fce0f-14c5-43ec-97f0-b968f479f3a1)
    ]
    coclass NostrOkResult
    {
        [default] interface INostrOkResult;
    };
};
